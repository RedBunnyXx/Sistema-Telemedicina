<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - MediConnect</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/Estilos/inicio.css}">
    <link rel="stylesheet" th:href="@{/Estilos/perfil.css}">

</head>
<body>

    <div class="dashboard-wrapper d-flex">

        <div th:replace="~{fragments/sidebar :: sidebar}"></div>

        <main class="main-content flex-grow-1 p-4 p-md-5">

            <div class="profile-view-container">
                
                <h1 class="page-title">Mi Perfil</h1>

                <div class="profile-layout">
                    
                    <div class="profile-photo-section">
                        <div class="photo-wrapper">
                            <img th:if="${persona.fotoPerfil != null}"
                                 th:src="@{'/uploads/perfiles/' + ${persona.fotoPerfil}}"
                                 alt="Foto de Perfil">
                            <img th:if="${persona.fotoPerfil == null}"
                                 src="https://img.freepik.com/foto-gratis/hombre-joven-guapo-nuevo-corte-pelo-estilo_176420-19637.jpg"
                                 alt="Foto de Perfil">
                            <button class="btn-icon-camera"><i class="fa-solid fa-camera"></i></button>
                        </div>

                        <div th:if="${fotoActualizada}" class="alert alert-success mt-3">
                            Foto de perfil actualizada.
                        </div>
                        <div th:if="${errorFoto}" class="alert alert-danger mt-3" th:text="${errorFoto}"></div>

                        <form th:action="@{/perfil/foto}" method="post" enctype="multipart/form-data" class="mt-2" id="form-foto-perfil">
                            <input type="file" id="input-foto-perfil" name="foto" accept="image/*" style="display: none;">
                            <button type="button" class="btn-change-photo" id="btn-cambiar-foto">
                                <i class="fa-solid fa-video"></i> Cambiar foto
                            </button>
                        </form>

                        <div class="user-identity">
                            <h2 th:text="${nombreCompleto}">Nombre Paciente</h2>
                            <p class="role-badge" th:text="${tipoPersona}">Paciente</p>
                        </div>
                    </div>

                    <div class="profile-forms-section">
                        
                        <div class="card info-card">
                            <div class="card-header">
                                <h3>Información Personal</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>DNI:</label>
                                    <input type="text" th:value="${persona.dni}" disabled class="input-readonly">
                                </div>
                                <div class="form-group">
                                    <label>Fecha de Nacimiento:</label>
                                    <input type="text" th:value="${#temporals.format(paciente.fechaNacimiento, 'dd/MM/yyyy')}" disabled class="input-readonly">
                                </div>
                                <div class="form-group">
                                    <label>Fecha de Registro:</label>
                                    <input type="text" th:value="${#temporals.format(persona.fechaRegistro, 'dd/MM/yyyy HH:mm')}" disabled class="input-readonly">
                                </div>
                            </div>
                        </div>

                        <div class="card contact-card">
                            <div class="card-header">
                                <h3>Información de Contacto (Editable)</h3>
                            </div>
                            <div class="card-body">
                                <div th:if="${perfilActualizado}" class="alert alert-success mb-3">
                                    Datos actualizados correctamente.
                                </div>
                                <div th:if="${errorPerfil}" class="alert alert-danger mb-3" th:text="${errorPerfil}"></div>

                                <form th:action="@{/perfil}" method="post">
                                    <div class="form-group">
                                        <label>Teléfono:</label>
                                        <div class="input-with-icon">
                                            <input type="text" name="telefono" th:value="${persona.telefono}">
                                            <i class="fa-solid fa-pencil icon-edit"></i>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Correo Electrónico:</label>
                                        <div class="input-with-icon">
                                            <input type="email" name="correo" th:value="${persona.correo}">
                                            <i class="fa-solid fa-pencil icon-edit"></i>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Dirección de Domicilio:</label>
                                        <div class="input-with-icon">
                                            <input type="text" name="direccion" th:value="${persona.direccion}">
                                            <i class="fa-solid fa-pencil icon-edit"></i>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn-save-changes">Guardar Cambios</button>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </main>

    </div>

    <script>
        (function () {
            const fileInput = document.getElementById('input-foto-perfil');
            const changePhotoBtn = document.getElementById('btn-cambiar-foto');
            const formFoto = document.getElementById('form-foto-perfil');

            if (fileInput && changePhotoBtn && formFoto) {
                changePhotoBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    fileInput.click();
                });

                fileInput.addEventListener('change', function () {
                    if (fileInput.files && fileInput.files.length > 0) {
                        formFoto.submit();
                    }
                });
            }
        })();
    </script>

</body>
</html>